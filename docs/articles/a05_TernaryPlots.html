<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ternary plots • Rage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ternary plots">
<meta property="og:description" content="Rage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_GettingStarted.html">Getting started with Rage</a>
    </li>
    <li>
      <a href="../articles/a02_VitalRates.html">Deriving vital rates from an MPM</a>
    </li>
    <li>
      <a href="../articles/a03_LifeHistoryTraits.html">Deriving life history traits from an MPM</a>
    </li>
    <li>
      <a href="../articles/a04_AgeFromStage.html">Age-from-stage analyses</a>
    </li>
    <li>
      <a href="../articles/a05_TernaryPlots.html">Ternary plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonesor/Rage/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a05_TernaryPlots_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ternary plots</h1>
                        <h4 class="author">Rob Salguero-Gomez and Owen Jones</h4>
            
            <h4 class="date">2021-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonesor/Rage/blob/master/vignettes/a05_TernaryPlots.Rmd"><code>vignettes/a05_TernaryPlots.Rmd</code></a></small>
      <div class="hidden name"><code>a05_TernaryPlots.Rmd</code></div>

    </div>

    
    
<p>Here we produce a ternary plot <em>a la</em> Silvertown &amp; Franco (1993) with population growth rate as the “fourth” dimension. We will use functions from the <code>popdemo</code>, <code>Rage</code> and <code>ggtern</code> packages, so first we need to load those packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rcompadre">Rcompadre</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">popdemo</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rage">Rage</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.ggtern.com">ggtern</a></span><span class="op">)</span></code></pre></div>
<p>Next, we will load the dataset directly from the COMPADRE online repository. Then, we will subset making sure that we only select matrix population models (<em>MPMs</em>, hereafter) fulfilling two conditions. The first one is that the components of the MPM <strong>A</strong> (e.g. <strong>A</strong> = <strong>U</strong> + <strong>F</strong> + <strong>C</strong>; <strong>U</strong>: survival-dependent matrix; <strong>F</strong>: sexual reproduction matrix; <strong>C</strong>: clonal reproduction matrix) have already been split so we can automatically calculate vital-rate dependent processes (e.g. elasticities of population growth rate (*$). The second condition is that the MPM <strong>A</strong> must be non-ergodic (See Caswell 2001 for further details), so there is a unique solution for the dominant eigenvalue of <strong>A</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Compadre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/cdb_flag.html">cdb_flag</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Compadre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Compadre</span>, <span class="va">MatrixSplit</span> <span class="op">==</span> <span class="st">"Divided"</span> <span class="op">&amp;</span> <span class="va">check_ergodic</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We can calculate elasticities of population growth rate to changes in the matrix elements using the <code>elas</code> function from the <code>popdemo</code> package. For example, the elasticity matrix for the first <strong>A</strong> matrix in this example database looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/elas.html">elas</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matA</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;        A1      A2      A3      A4</span>
<span class="co">#&gt; A1 0.1646 0.06524 0.02431 0.03132</span>
<span class="co">#&gt; A2 0.1209 0.16722 0.04893 0.01683</span>
<span class="co">#&gt; A3 0.0000 0.07803 0.11047 0.02795</span>
<span class="co">#&gt; A4 0.0000 0.04336 0.03274 0.06818</span></code></pre></div>
<p>Because the subset of MPMs here has split <strong>A</strong> into the matrices <strong>U</strong>, <strong>F</strong>, and <strong>C</strong>, we can now also automatise the calculation of elasticities, regardless of the varying degree of life cycle complexities represented in these MPMs. Therefore, we can classify the elements of the matrix to changes in stages (which we can further identify as stasis, progression, and retrogression), sexual reproduction, and clonal reproduction.</p>
<p>We can use the <code>matrixElementPerturbation</code> function from the <code>Rage</code> package to conduct this element-by-element elasticity analysis. The function outputs both sensitivities (prefixed with S) and elasticities (prefixed with E) as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mat_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matA</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="fu"><a href="../reference/perturb_matrix.html">perturb_matrix</a></span><span class="op">(</span><span class="va">mat_a</span>, type <span class="op">=</span> <span class="st">"elasticity"</span><span class="op">)</span>
<span class="co">#&gt;        A1      A2      A3      A4</span>
<span class="co">#&gt; A1 0.1646 0.06524 0.02431 0.03132</span>
<span class="co">#&gt; A2 0.1209 0.16722 0.04893 0.01683</span>
<span class="co">#&gt; A3 0.0000 0.07803 0.11047 0.02795</span>
<span class="co">#&gt; A4 0.0000 0.04336 0.03274 0.06818</span>

<span class="co">#Rage::matrixElementPerturbation(matU = matU(Compadre)[[1]],    This function used to be able to accommodate partioning</span>
<span class="co">#                                matF = matF(Compadre)[[1]],    into U F and C so we coudl partition this... but it's now gone</span>
<span class="co">#                                matC = matC(Compadre)[[1]])    in perturb_matrix.... why?</span></code></pre></div>
<p>We can use a <code>for</code> loop to run through each set of matrices in turn to calculate the summed elasticity for survival (S), growth (G) and reproduction (R) like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Amats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matA</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Umats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matU</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Fmats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matF</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Cmats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matC</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">)</span><span class="op">)</span>,G<span class="op">=</span><span class="cn">NA</span>,R<span class="op">=</span><span class="cn">NA</span>,lam<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perturb_vr.html">perturb_vr</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,   <span class="co">#The same issue as above</span>
                     <span class="va">Fmats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">Cmats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                     type <span class="op">=</span> <span class="st">"elasticity"</span><span class="op">)</span>
  
  <span class="va">output</span><span class="op">$</span><span class="va">S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">survival</span>
  <span class="va">output</span><span class="op">$</span><span class="va">G</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">growth</span> <span class="op">+</span> <span class="va">temp</span><span class="op">$</span><span class="va">shrinkage</span>
  <span class="va">output</span><span class="op">$</span><span class="va">R</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">fecundity</span> <span class="op">+</span> <span class="va">temp</span><span class="op">$</span><span class="va">clonality</span>
  
  <span class="co">#Calculate growth rate</span>
  <span class="va">output</span><span class="op">$</span><span class="va">lam</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html">eigs</a></span><span class="op">(</span><span class="va">Amats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"lambda"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span></code></pre></div>
<p>Let’s take a look at this output:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>
<span class="co">#&gt;        S         G        R    lam</span>
<span class="co">#&gt; 1 1.0000  0.077204 0.137697 1.0580</span>
<span class="co">#&gt; 2 0.9999  0.192840 0.154347 1.4118</span>
<span class="co">#&gt; 3 1.0000  0.001738 0.007431 0.9962</span>
<span class="co">#&gt; 4 1.0000  0.194813 0.284477 1.1242</span>
<span class="co">#&gt; 5 1.0000 -0.000474 0.003098 0.9659</span>
<span class="co">#&gt; 6 1.0000 -0.351430 0.000000 0.9155</span></code></pre></div>
<p>Now we have elasticities for our three demographic processes we can place these onto a ternary plot. However, we should first scale the elasticities so that they sum to 1 - this is necessary because of possible rounding issues:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">output</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now for the plot:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">B</span><span class="op">&lt;-</span><span class="fu">ggtern</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/ggtern.html">ggtern</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">output</span>,
                  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">R</span>,
                      y <span class="op">=</span> <span class="va">G</span>,
                      z <span class="op">=</span> <span class="va">S</span>,
                      colour <span class="op">=</span> <span class="va">lam</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>    
  <span class="fu">scale_color_viridis_c</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/theme_showarrows.html">theme_showarrows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/theme_clockwise.html">theme_clockwise</a></span><span class="op">(</span><span class="op">)</span> 

<span class="va">B</span></code></pre></div>
<p><img src="a05_TernaryPlots_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Now you can try this, try using another variable, such as reactivity, or life expectancy as the “fourth” dimension instead of lambda.</p>
<p>IN THE TEXT BELOW I RE-DO THE FUNCTIONALITY ABOVE AT THE VITAL RATE LEVEL. WE SHOULD FIRST FIX THE FUNCTION ABOVE SO IT DOES THE PARTITIONING OF MATRICES INTO SUBCOMPONENTS U F AND C</p>
<p>We can use the <code>perturb_vr</code> function from the <code>Rage</code> package to conduct the perturbations at the level of underlying vital rates rather than matrix elements. It is worth noting that in a MPM, most matrix elements are composites of vital rates. For instance, the element a[2,1] (second row, first column in the matrix <strong>A</strong>) is composed by the survival probability of the first stage <em>times</em> the probability that individuals in the first stage transition to the second one in the life cycle of the species. To proceed with the calculation of the vital rate perturbations:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mpm1</span><span class="op">)</span>

<span class="fu"><a href="../reference/perturb_vr.html">perturb_vr</a></span><span class="op">(</span><span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>,
           <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>,
           <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>,
           type <span class="op">=</span> <span class="st">"elasticity"</span><span class="op">)</span>
<span class="co">#&gt; $survival</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $growth</span>
<span class="co">#&gt; [1] 0.3844</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $shrinkage</span>
<span class="co">#&gt; [1] -0.02546</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fecundity</span>
<span class="co">#&gt; [1] 0.2228</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $clonality</span>
<span class="co">#&gt; [1] 0.2228</span></code></pre></div>
<p>We can use a <code>for</code> loop to run through each set of matrices in turn to calculate the summed elasticity for (i) survival (<span class="math inline">\(\sigma), (ii) growth (\)</span>) and shrinkage (<span class="math inline">\(\rho), and (iii) sexual (\)</span>) and clonal reproduction ($) like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Amats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matA</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Umats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matU</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Fmats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matF</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>
<span class="va">Cmats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html">matC</a></span><span class="op">(</span><span class="va">Compadre</span><span class="op">)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>survival<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">)</span><span class="op">)</span>,growthShrinkage<span class="op">=</span><span class="cn">NA</span>,reproduction<span class="op">=</span><span class="cn">NA</span>,lam<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perturb_vr.html">perturb_vr</a></span><span class="op">(</span><span class="va">Umats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">Fmats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">Cmats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                     type <span class="op">=</span> <span class="st">"elasticity"</span><span class="op">)</span>
  
<span class="va">output</span><span class="op">$</span><span class="va">survival</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">survival</span>
<span class="va">output</span><span class="op">$</span><span class="va">growthShrinkage</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">growth</span> <span class="op">+</span> <span class="va">temp</span><span class="op">$</span><span class="va">shrinkage</span>
<span class="va">output</span><span class="op">$</span><span class="va">reproduction</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">fecundity</span> <span class="op">+</span> <span class="va">temp</span><span class="op">$</span><span class="va">clonality</span>

<span class="co">#Calculate growth rate</span>
<span class="va">output</span><span class="op">$</span><span class="va">lam</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html">eigs</a></span><span class="op">(</span><span class="va">Amats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"lambda"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span>

<span class="co">#&gt; Warning: All elements of matF are zero</span></code></pre></div>
<p>Let’s take a look at this output:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>
<span class="co">#&gt;   survival growthShrinkage reproduction    lam</span>
<span class="co">#&gt; 1   1.0000        0.077204     0.137697 1.0580</span>
<span class="co">#&gt; 2   0.9999        0.192840     0.154347 1.4118</span>
<span class="co">#&gt; 3   1.0000        0.001738     0.007431 0.9962</span>
<span class="co">#&gt; 4   1.0000        0.194813     0.284477 1.1242</span>
<span class="co">#&gt; 5   1.0000       -0.000474     0.003098 0.9659</span>
<span class="co">#&gt; 6   1.0000       -0.351430     0.000000 0.9155</span></code></pre></div>
<p>Now we have elasticities for our three collapsed vital rate processes we can place these onto a ternary plot. However, we should first scale the elasticities so that they sum to 1 - this is necessary because of possible rounding issues:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">output</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now for the plot:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">B</span><span class="op">&lt;-</span><span class="fu">ggtern</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/ggtern.html">ggtern</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">output</span>,
                  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">reproduction</span>,
                      y <span class="op">=</span> <span class="va">growthShrinkage</span>,
                      z <span class="op">=</span> <span class="va">survival</span>,
                      colour <span class="op">=</span> <span class="va">lam</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">scale_color_viridis_c</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/theme_showarrows.html">theme_showarrows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtern/man/theme_clockwise.html">theme_clockwise</a></span><span class="op">(</span><span class="op">)</span> 

<span class="va">B</span></code></pre></div>
<p><img src="a05_TernaryPlots_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Patrick Barks, Pol Capdevila, Judy P. Che-Castaldo, John Jackson, Tamora James, Owen Jones, Sam Levin, William K. Petry, Roberto Salguero-Gomez, Iain Stott, Chelsea C. Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
