<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deriving vital rates from an MPM • Rage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Deriving vital rates from an MPM">
<meta property="og:description" content="Rage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_GettingStarted.html">Getting started with Rage</a>
    </li>
    <li>
      <a href="../articles/a02_VitalRates.html">Deriving vital rates from an MPM</a>
    </li>
    <li>
      <a href="../articles/a03_LifeHistoryTraits.html">Deriving life history traits from an MPM</a>
    </li>
    <li>
      <a href="../articles/a04_AgeFromStage.html">Age-from-stage analyses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonesor/Rage/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a02_VitalRates_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deriving vital rates from an MPM</h1>
                        <h4 class="author">Patrick Barks</h4>
            
            <h4 class="date">2021-09-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonesor/Rage/blob/master/vignettes/a02_VitalRates.Rmd"><code>vignettes/a02_VitalRates.Rmd</code></a></small>
      <div class="hidden name"><code>a02_VitalRates.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The transition rates that make up matrix population models (MPMs) generally reflect products of two or more vital rates (sometimes called ‘lower-level vital rates’). Assuming a post-breeding census design, we can retroactively break apart each transition rate into at least two vital rate components: survival, and ‘something’ conditional on survival. That ‘something’ might be growth, shrinkage, stasis, dormancy, fecundity, or clonality.</p>
<p>The <code>vr_</code> group of functions can be used to derive vital rates from any MPM that was initially estimated using a post-breeding census design. The vital rates may be summarized across the entire MPM (<code>vr_</code> functions), summarized within stage classes (<code>vr_vec_</code> functions), or not summarized (<code>vr_mat_</code> functions).</p>
</div>
<div id="preliminaries-constructing-an-mpm-from-lower-level-vital-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries-constructing-an-mpm-from-lower-level-vital-rates" class="anchor"></a>Preliminaries: Constructing an MPM from lower-level vital rates</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rage">Rage</a></span><span class="op">)</span></code></pre></div>
<p>We’ll start by creating an MPM based on a set of underlying vital rates. Our MPM will be separated into a growth/survival component (<code>matU</code>) and a sexual reproduction component (<code>matF</code>), and consist of 4 stage classes: ‘seed’, ‘small’, ‘large’, and ‘dormant’. First we’ll specify the vital rates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## survival probabilities</span>
<span class="va">s1</span> <span class="op">&lt;-</span> <span class="fl">0.20</span>  <span class="co"># seed</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fl">0.40</span>  <span class="co"># small</span>
<span class="va">s3</span> <span class="op">&lt;-</span> <span class="fl">0.50</span>  <span class="co"># large</span>
<span class="va">s4</span> <span class="op">&lt;-</span> <span class="fl">0.30</span>  <span class="co"># dormant</span>

<span class="co">## matU vital rates conditional on survival (growth, shrinkage, stasis, etc.)</span>
<span class="va">g12</span> <span class="op">&lt;-</span> <span class="fl">0.15</span>           <span class="co"># seed to small      (growth)</span>
<span class="va">g13</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>           <span class="co"># seed to large      (growth)</span>
<span class="va">g11</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">g12</span> <span class="op">-</span> <span class="va">g13</span>  <span class="co"># seed to seed       (stasis)</span>
<span class="va">g23</span> <span class="op">&lt;-</span> <span class="fl">0.45</span>           <span class="co"># small to large     (growth)</span>
<span class="va">g24</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>           <span class="co"># small to dormant   (enter dormancy)</span>
<span class="va">g22</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">g23</span> <span class="op">-</span> <span class="va">g24</span>  <span class="co"># small to small     (stasis)</span>
<span class="va">g34</span> <span class="op">&lt;-</span> <span class="fl">0.22</span>           <span class="co"># large to dormant   (enter dormancy)</span>
<span class="va">g33</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">g34</span>        <span class="co"># large to large     (stasis)</span>
<span class="va">g43</span> <span class="op">&lt;-</span> <span class="fl">0.50</span>           <span class="co"># dormant to large   (exit dormancy)</span>
<span class="va">g44</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">g43</span>        <span class="co"># dormant to dormant (stasis)</span>

<span class="co">## matF vital rates conditional on survival (i.e. fecundity)</span>
<span class="va">f2</span> <span class="op">&lt;-</span> <span class="fl">0.4</span>   <span class="co"># small</span>
<span class="va">f3</span> <span class="op">&lt;-</span> <span class="fl">1.1</span>   <span class="co"># large</span></code></pre></div>
<p>Next we’ll use the vital rates to construct an MPM, based on a post-breeding census design.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># growth/survival component</span>
<span class="va">matU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">s1</span><span class="op">*</span><span class="va">g11</span>,      <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">s1</span><span class="op">*</span><span class="va">g12</span>, <span class="va">s2</span><span class="op">*</span><span class="va">g22</span>,      <span class="fl">0</span>,      <span class="fl">0</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">s1</span><span class="op">*</span><span class="va">g13</span>, <span class="va">s2</span><span class="op">*</span><span class="va">g23</span>, <span class="va">s3</span><span class="op">*</span><span class="va">g33</span>, <span class="va">s4</span><span class="op">*</span><span class="va">g43</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>     <span class="fl">0</span>, <span class="va">s2</span><span class="op">*</span><span class="va">g24</span>, <span class="va">s3</span><span class="op">*</span><span class="va">g34</span>, <span class="va">s4</span><span class="op">*</span><span class="va">g44</span><span class="op">)</span><span class="op">)</span>

<span class="co"># sexual reproduction component</span>
<span class="va">matF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>     <span class="fl">0</span>,  <span class="va">s2</span><span class="op">*</span><span class="va">f2</span>,  <span class="va">s3</span><span class="op">*</span><span class="va">f3</span>,      <span class="fl">0</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>     <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>     <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>     <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span>,      <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="deriving-vital-rates-of-survival" class="section level2">
<h2 class="hasAnchor">
<a href="#deriving-vital-rates-of-survival" class="anchor"></a>Deriving vital rates of survival</h2>
<p>Given a post-breeding census design, stage-specific vital rates of survival can be obtained by taking column sums of the <strong>U</strong> matrix (<code>matU</code> in our code). This works out algebraically because the other vital rates within <code>matU</code>, which are conditional on survival, must sum to 1 within a given stage class. We can obtain a vector of stage-specific vital rates of survival using the <code><a href="../reference/vr_vec.html">vr_vec_survival()</a></code> function, which, for simple cases, is equivalent to <code><a href="https://rdrr.io/r/base/colSums.html">colSums()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vr_vec.html">vr_vec_survival</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2 0.4 0.5 0.3</span>
<span class="co"># equivalent to...</span>
<span class="op">(</span><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2 0.4 0.5 0.3</span></code></pre></div>
<p>As expected, these values match the survival probabilities that we initially specified.</p>
</div>
<div id="deriving-vital-rates-conditional-on-survival" class="section level2">
<h2 class="hasAnchor">
<a href="#deriving-vital-rates-conditional-on-survival" class="anchor"></a>Deriving vital rates conditional on survival</h2>
<p>To obtain the other set of vital rates — vital rates conditional on survival (sometimes called ‘survival-independent vital rates’) — we simply need to divide each column of <code>matU</code> or <code>matF</code> by the corresponding survival probability. This procedure is implemented by the <code>vr_mat_</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># matU vital rates conditional on survival</span>
<span class="fu"><a href="../reference/vr_mat.html">vr_mat_U</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4]</span>
<span class="co">#&gt; [1,] 0.80   NA   NA   NA</span>
<span class="co">#&gt; [2,] 0.15 0.45   NA   NA</span>
<span class="co">#&gt; [3,] 0.05 0.45 0.78  0.5</span>
<span class="co">#&gt; [4,]   NA 0.10 0.22  0.5</span>

<span class="co"># matF vital rates conditional on survival</span>
<span class="fu"><a href="../reference/vr_mat.html">vr_mat_R</a></span><span class="op">(</span><span class="va">matU</span>, <span class="va">matF</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4]</span>
<span class="co">#&gt; [1,]   NA  0.4  1.1   NA</span>
<span class="co">#&gt; [2,]   NA   NA   NA   NA</span>
<span class="co">#&gt; [3,]   NA   NA   NA   NA</span>
<span class="co">#&gt; [4,]   NA   NA   NA   NA</span></code></pre></div>
<p>We’ve now recovered all the vital rates that we initially specified when we constructed our MPM.</p>
</div>
<div id="summarizing-vital-rates-within-stages" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizing-vital-rates-within-stages" class="anchor"></a>Summarizing vital rates within stages</h2>
<p>The vital rates produced by <code><a href="../reference/vr_mat.html">vr_mat_U()</a></code> represent a variety of processes, including growth, shrinkage, stasis, and dormancy. To summarize these processes within stage classes we can use the <code>vr_vec_</code> group of functions, which simply sum the vital rates corresponding to a given process within stage classes.</p>
<div id="growth-shrinkage-stasis-and-dormancy" class="section level4">
<h4 class="hasAnchor">
<a href="#growth-shrinkage-stasis-and-dormancy" class="anchor"></a>Growth, shrinkage, stasis, and dormancy</h4>
<p>We’ll start by examining vital rates of growth, which will be found in the bottom-left triangle of the <strong>U</strong> matrix. Given the results from <code><a href="../reference/vr_mat.html">vr_mat_U()</a></code> above, our baseline expectation for the stage-specific vital rates of growth would be 0.20 (0.15 + 0.05), 0.55 (0.45 + 0.10), 0.22, and NA.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_growth</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.20 0.55 0.22   NA</span></code></pre></div>
<p>However, the calculations above include transitions to the dormant stage class as a component of ‘growth’, because the dormant stage class is represented by the right-most column (and so transitions to the dormant stage are in the bottom-left triangle of <code>matU</code>). To exclude transitions <em>to</em> the dormant stage from our calculation of growth, we can set the <code>exclude_row</code> argument to <code>4</code>, so that any survival-independent transition <em>to</em> stage 4 is excluded from the calculation of growth.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_growth</a></span><span class="op">(</span><span class="va">matU</span>, exclude_row <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.20 0.45   NA   NA</span></code></pre></div>
<p>Next let’s examine vital rates of shrinkage, which will occur in the top-right triangle of <code>matU</code>. Based again on the results from <code><a href="../reference/vr_mat.html">vr_mat_U()</a></code>, our naive expectation for vital rates of shrinkage would be NA, NA, NA, 0.5.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_shrinkage</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt; [1]  NA  NA  NA 0.5</span></code></pre></div>
<p>However, in this case, the transition from the dormant stage to the large stage is being mistakenly considered as shrinkage, simply because it’s in the top-right triangle of <code>matU</code>. To exclude transitions <em>from</em> the dormant stage from our calculations, we can set the <code>exclude_col</code> argument to <code>4</code>. Note that we use <code>exclude_row</code> to exclude transitions <em>to</em> a given stage, and <code>exclude_col</code> to exclude transitions <em>from</em> a given stage.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_shrinkage</a></span><span class="op">(</span><span class="va">matU</span>, exclude_col <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1] NA NA NA NA</span></code></pre></div>
<p>Next let’s calculate vital rates of stasis, which occur along the diagonal of <code>matU</code>. Depending on our purpose, we may or may not consider the dormant to dormant transition as ‘stasis’. If not, we could exclude it using one of the <code>exclude_</code> arguments, as above. But we’ll leave it in for now.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_stasis</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.80 0.45 0.78 0.50</span></code></pre></div>
<p>Finally, let’s calculate vital rates for entering and exiting dormancy. For these, we’ll need to explicitly specify which stage(s) are dormant using the <code>dorm_stages</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_dorm_enter</a></span><span class="op">(</span><span class="va">matU</span>, dorm_stages <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1]   NA 0.10 0.22   NA</span>
<span class="fu"><a href="../reference/vr_vec.html">vr_vec_dorm_exit</a></span><span class="op">(</span><span class="va">matU</span>, dorm_stages <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1]  NA  NA  NA 0.5</span></code></pre></div>
</div>
<div id="fecundity" class="section level4">
<h4 class="hasAnchor">
<a href="#fecundity" class="anchor"></a>Fecundity</h4>
<p>The survival-independent vital rates of fecundity produced by <code><a href="../reference/vr_mat.html">vr_mat_R()</a></code> are more straightforward to summarize, as they only reflect a single process (i.e. fecundity).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_reproduction</a></span><span class="op">(</span><span class="va">matU</span>, <span class="va">matF</span><span class="op">)</span>
<span class="co">#&gt; [1]  NA 0.4 1.1  NA</span></code></pre></div>
<p>In the example MPM we’re using here, individuals produced by fecundity always begin life in the ‘seed’ stage. However, for some life cycles there are multiple stages in which an offspring could begin life. In these cases, it may be desirable to weight the different types of offspring when summing vital rates of fecundity within a stage class (e.g. by their reproductive value). This type of weighting can be accomplished with the <code>weights_row</code> argument.</p>
</div>
</div>
<div id="summarizing-vital-rates-across-stages" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizing-vital-rates-across-stages" class="anchor"></a>Summarizing vital rates across stages</h2>
<p>In some cases, it may be desirable to summarize vital rates across stage classes to obtain a single mean vital rate for the entire MPM. This can be done using the <code>vr_</code> group of functions.</p>
<div id="simple-average-across-stage-classes" class="section level4">
<h4 class="hasAnchor">
<a href="#simple-average-across-stage-classes" class="anchor"></a>Simple average across stage classes</h4>
<p>By default, the <code>vr_</code> functions take a simple average of the stage-specific vital rates returned by the corresponding <code>vr_vec_</code> function. Here’s an example with growth.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr.html">vr_growth</a></span><span class="op">(</span><span class="va">matU</span>, exclude_row <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.325</span>

<span class="co"># equivalent to</span>
<span class="op">(</span><span class="va">vec_growth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vr_vec.html">vr_vec_growth</a></span><span class="op">(</span><span class="va">matU</span>, exclude_row <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.20 0.45   NA   NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vec_growth</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.325</span></code></pre></div>
<p>Note that the two stage classes from which there are no growth transitions do not contribute to the MPM-average vital rate of growth. In practice, this is because the <code>vr_vec_</code> functions return NAs rather than 0s for stages that do not exhibit the relevant transition type. This is an important issue that we’ll return to in a later section.</p>
</div>
<div id="weighted-average-across-stage-classes" class="section level4">
<h4 class="hasAnchor">
<a href="#weighted-average-across-stage-classes" class="anchor"></a>Weighted average across stage classes</h4>
<p>Rather than taking a simple average of the given vital rate across stage classes, we may wish to take a <em>weighted</em> average across stage classes. For instance, we may wish to weight stage classes based on the stable distribution at equilibrium. Here’s an example of how to do that using the <code>weights_col</code> argument.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate the stable distribution using popbio::stable.stage</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">popbio</span><span class="op">)</span>
<span class="va">matA</span> <span class="op">&lt;-</span> <span class="va">matU</span> <span class="op">+</span> <span class="va">matF</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">popbio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popbio/man/stable.stage.html">stable.stage</a></span><span class="op">(</span><span class="va">matA</span><span class="op">)</span>

<span class="co"># calculate mean vital rate of growth weighted by the stable distribution</span>
<span class="fu"><a href="../reference/vr.html">vr_growth</a></span><span class="op">(</span><span class="va">matU</span>, exclude_row <span class="op">=</span> <span class="fl">4</span>, weights_col <span class="op">=</span> <span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2220831</span>

<span class="co"># equivalent to</span>
<span class="va">pos</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">vec_growth</span><span class="op">)</span>                   <span class="co"># possible transitions</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vec_growth</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">*</span> <span class="va">w</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span><span class="op">)</span> <span class="co"># weighted average</span>
<span class="co">#&gt; [1] 0.2220831</span></code></pre></div>
</div>
</div>
<div id="distinguishing-between-possible-and-impossible-transitions" class="section level2">
<h2 class="hasAnchor">
<a href="#distinguishing-between-possible-and-impossible-transitions" class="anchor"></a>Distinguishing between possible and impossible transitions</h2>
<p>By default, all <code>vr_</code> functions assume that a transition rate of 0 indicates an impossible transition within the given life cycle (e.g. tadpoles never revert to eggs), in which case a value of <code>NA</code> will be used in any relevant calculations. However, a transition rate of 0 could alternatively indicate a transition that is generally possible, but was simply estimated to be 0 in the relevant population and time period.</p>
<p>This distinction between possible and impossible transitions can be important when calculating vital rates — particularly if we want to summarize vital rates across stages (i.e. summarize at the level of the MPM).</p>
<p>Let’s consider the same <code>matU</code> we defined above, but imagine that it reflects a life cycle with a different set of stages: ‘seed’, ‘small’, ‘medium’, and ‘large’. Now our MPM has a single shrinkage transition (large to medium). If we summarize the vital rate of shrinkage across stages using <code><a href="../reference/vr.html">vr_shrinkage()</a></code>, we’ll simply recover the single shrinkage vital rate from the large to medium transition (i.e. because the other stages, with no shrinkage, do not contribute to the average).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vr_vec.html">vr_vec_shrinkage</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt; [1]  NA  NA  NA 0.5</span>
<span class="fu"><a href="../reference/vr.html">vr_shrinkage</a></span><span class="op">(</span><span class="va">matU</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.5</span></code></pre></div>
<p>However, imagine now that the medium to small transition, which is 0 within <code>matU</code>, is in fact a possible shrinkage transition in our life cycle of interest — its rate was simply estimated to be 0 in the relevant sample and time period. In this case, we’ll need to manually specify the matrix of possible transitions using the <code>posU</code> argument.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="va">matU</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># possible transitions based on matU</span>
<span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]</span>
<span class="co">#&gt; [1,]  TRUE FALSE FALSE FALSE</span>
<span class="co">#&gt; [2,]  TRUE  TRUE FALSE FALSE</span>
<span class="co">#&gt; [3,]  TRUE  TRUE  TRUE  TRUE</span>
<span class="co">#&gt; [4,] FALSE  TRUE  TRUE  TRUE</span>
<span class="va">pos</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># set medium-to-small shrinkage tr to possible</span>

<span class="fu"><a href="../reference/vr_vec.html">vr_vec_shrinkage</a></span><span class="op">(</span><span class="va">matU</span>, posU <span class="op">=</span> <span class="va">pos</span><span class="op">)</span>
<span class="co">#&gt; [1]  NA  NA 0.0 0.5</span>
<span class="fu"><a href="../reference/vr.html">vr_shrinkage</a></span><span class="op">(</span><span class="va">matU</span>, posU <span class="op">=</span> <span class="va">pos</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.25</span></code></pre></div>
<p>Now, instead of returning <code>NA</code> for the vital rate of shrinkage from the medium stage class, <code><a href="../reference/vr_vec.html">vr_vec_shrinkage()</a></code> returns a value of 0. Correspondingly, <code><a href="../reference/vr.html">vr_shrinkage()</a></code> incorporates this 0 into its calculation and returns an MPM-average shrinkage rate of 0.25 (<code>mean(c(0, 0.5)</code>) rather than 0.5, as before.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Caswell, H. (2001). Matrix Population Models: Construction, Analysis, and Interpretation. 2nd edition. Sinauer Associates, Sunderland, MA. ISBN-10: 0878930965</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Patrick Barks, Pol Capdevila, Hal Caswell, Judy P. Che-Castaldo, John Jackson, Tamora James, Owen Jones, Sam Levin, William K. Petry, Roberto Salguero-Gomez, Iain Stott, Chelsea C. Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
