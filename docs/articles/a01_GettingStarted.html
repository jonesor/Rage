<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with Rage • Rage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with Rage">
<meta property="og:description" content="Rage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_GettingStarted.html">Getting started with Rage</a>
    </li>
    <li>
      <a href="../articles/a02_VitalRates.html">Deriving vital rates from an MPM</a>
    </li>
    <li>
      <a href="../articles/a03_LifeHistoryTraits.html">Deriving life history traits from an MPM</a>
    </li>
    <li>
      <a href="../articles/a04_AgeFromStage.html">Age-from-stage analyses</a>
    </li>
    <li>
      <a href="../articles/a05_SuggestedQualityControl.html">Suggested quality control</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonesor/Rage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a01_GettingStarted_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="a01_GettingStarted_files/viz-1.8.2/viz.js"></script><link href="a01_GettingStarted_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="a01_GettingStarted_files/grViz-binding-1.0.9/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with Rage</h1>
                        <h4 data-toc-skip class="author">Patrick
Barks</h4>
                        <h4 data-toc-skip class="author">William K.
Petry</h4>
            
            <h4 data-toc-skip class="date">2023-09-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonesor/Rage/blob/HEAD/vignettes/a01_GettingStarted.Rmd" class="external-link"><code>vignettes/a01_GettingStarted.Rmd</code></a></small>
      <div class="hidden name"><code>a01_GettingStarted.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>Rage</code> provides tools for manipulating and analysing
matrix population models (MPMs). This vignette introduces the structure
of the input and highlights key analysis functions across the
package.</p>
</div>
<div class="section level2">
<h2 id="recap-assumed-knowledge">Recap: Assumed knowledge<a class="anchor" aria-label="anchor" href="#recap-assumed-knowledge"></a>
</h2>
<p>The functions in <code>Rage</code> assume that the reader is familiar
with the basic structure of MPMs and how they are used to project
population change and basic demographic statistics (e.g., the
equilibrium population growth rate, <span class="math inline">\(\lambda\)</span>). This section is intended as a
recap of these concepts–readers ready to begin calculating more advanced
life history metrics may want to skip ahead to <a href="#mpms_in_r">the
next section</a>. We refer readers to <a href="#references">Caswell
(2001)</a> for a comprehensive introduction to MPMs.</p>
<div class="section level3">
<h3 id="r-1--basic-anatomy-of-life-cycles-and-mpms">R.1. Basic anatomy of life cycles and MPMs<a class="anchor" aria-label="anchor" href="#r-1--basic-anatomy-of-life-cycles-and-mpms"></a>
</h3>
<p>Matrix population models are a mathematical tool that integrate
population dynamics and population structure to model the dynamics of
populations with different ‘types’ of individuals, whether due to age,
life stage, sex, genotype or any other attribute that causes differences
in demographic rates. Consider a plant species with three different
types of individuals: <strong>seedlings</strong> that have newly
recruited into the population from seeds, non-reproductive
<strong>rosettes</strong>, and <strong>flowering</strong> adults that
make seeds and also reproduce asexually by vegetative budding. We can
represent the biology of this life cycle graphically (Fig. 1) where each
life stage is a node and the life stages are connected with arrows
showing the paths (and probabilities) that individuals move between
stages.</p>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-de0f0008aaa642e04321" style="width:576px;height:192px;"></div>
<script type="application/json" data-for="htmlwidget-de0f0008aaa642e04321">{"x":{"diagram":"\ndigraph {\n  {\n    graph[overlap=false];\n    rank=same;\n    node [shape= egg , fontsize= 12 ]; \"seedling\"; \"rosette\"; \"flowering\" \n  } ordering=out\n  x [style=invis]\n  x -> { \"seedling\"; \"rosette\"; \"flowering\" } [style=invis] \"seedling\" -> \"rosette\"[minlen=3,fontsize=10,color=PaleGreen4,xlabel=\" 0.5\"]\n\"rosette\" -> \"rosette\"[minlen=0,fontsize=10,color=PaleGreen4,xlabel=\" 0.3\"]\n\"rosette\" -> \"flowering\"[minlen=3,fontsize=10,color=PaleGreen4,xlabel=\" 0.4\"]\n\"flowering\" -> \"seedling\"[minlen=-6,fontsize=10,color=Goldenrod1,xlabel=\" 3.2\"]\n\"flowering\" -> \"rosette\"[minlen=-3,fontsize=10,color=MediumOrchid4,xlabel=\" 0.8\"]\n\"flowering\" -> \"flowering\"[minlen=0,fontsize=10,color=PaleGreen4,xlabel=\" 0.9\"]\n labelloc=\"t\";\n  label=\"  \"\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p><strong>Figure 1.</strong> Life cycle diagram for a hypothetical
plant with three life stages (nodes). Arrows are coloured by
conventional groupings of demographic processes: growth and survival
(green), sexual reproduction via seeds (gold) and asexual reproduction
via budding (purple). The numbers along each arrow indicate the
transition probability–how many individuals will there be in the stage
at the arrow’s end at the next time step for each individual at the
arrow’s start?</p>
<p>The <strong>transition</strong> or <strong>projection matrix</strong>
(Fig. 2; called <strong>A</strong> in matrix notation) for this life
cycle is a square matrix where the rows and columns correspond to the
life stages (nodes) and the elements correspond to transition
probabilities (arrows). By convention, the columns reflect the current
life stage (i.e., the arrow’s start) and the rows reflect the arrow’s
end.</p>
<p><img src="a01_GettingStarted_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;"><strong>Figure 2.</strong> Transition (projection) matrix corresponding
to the life cycle in Fig. 1.</p>
<p>For basic MPM projection and equilibrium analyses, this single matrix
is all that is needed. However, more advanced analyses like many of
those in <code>Rage</code> use decompositions of the <strong>A</strong>
matrix into its components of growth and survival (<strong>U</strong>)
and reproduction (<strong>R</strong>). Reproduction can be further
decomposed into offspring produced sexually (<strong>F</strong>) and
asexually/clonally (<strong>C</strong>; Fig. 3). The submatrices combine
additively to create the transition matrix,</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{A} &amp;= \mathbf{U} + \mathbf{R} \\
&amp;= \mathbf{U} + \left(\mathbf{F} + \mathbf{C}\right).
\end{aligned}
\]</span> In our example, all of the elements of <strong>A</strong> are
found in only one of the submatrices. However, other life cycles may
have multiple pathways from one life stage to another.</p>
<p><img src="a01_GettingStarted_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"><strong>Figure 3.</strong> Decomposition of the transition matrix,
<strong>A</strong>, into <strong>U</strong>, <strong>F</strong> and
<strong>C</strong> submatrices. The coloured elements correspond to the
coloured arrows in Fig. 1.</p>
</div>
<div class="section level3">
<h3 id="r-2--projecting-population-change">R.2. Projecting population change<a class="anchor" aria-label="anchor" href="#r-2--projecting-population-change"></a>
</h3>
<p>Simple matrix multiplication allows the full transition matrix,
<strong>A</strong>, to be projected forward in time for any starting
population. We initiate the model with a <em>population vector</em>,
<span class="math inline">\(\mathbf{n}_{t=0}\)</span>, that contains the
number of individuals in each life stage. Right multiplying the initial
population vector to the transition matrix, <strong>A</strong>, yields
the population vector at the next time step via the projection
equation,</p>
<p><span class="math display">\[
\mathbf{n}_{t+1} = \mathbf{A}\mathbf{n}_{t}.
\]</span> Suppose we initialize the example plant population, <span class="math inline">\(\mathbf{n}_{t=0}\)</span>, with five seedlings, 10
rosettes, and 15 flowering individuals. We expect that the population in
the next time step will be,</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{n}_{t=1} &amp;= \mathbf{A}\mathbf{n}_{t=0}, \\
\left[
\begin{matrix}
48.0 \\
17.5 \\
17.5
\end{matrix}
\right]
&amp;=
\left[
\begin{matrix}
0 &amp; 0 &amp; 3.2 \\
0.5 &amp; 0.3 &amp; 0.8 \\
0 &amp; 0.4 &amp; 0.9
\end{matrix}
\right]
\left[
\begin{matrix}
5 \\
10 \\
15
\end{matrix}
\right].
\end{aligned}
\]</span> Summing the population vectors gives us the total population
size (<span class="math inline">\(N_{t=0} =\sum\mathbf{n}_{t=0} =
30\)</span> and <span class="math inline">\(N_{t=1} = 83\)</span>).
Likewise, we can measure the instantaneous per-capita population growth
rate as <span class="math inline">\(N_{t+1}/N_{t} = 83/30 =
2.7\overline{6}\)</span>). Recursively substituting the new <span class="math inline">\(\mathbf{n}_{t+1}\)</span> into the projection
equation in place of <span class="math inline">\(\mathbf{n}_{t}\)</span>
allows us to continue projecting the population dynamics and life stage
composition forward in time.</p>
</div>
<div class="section level3">
<h3 id="r-3--analysis-of-population-equilibrium-eigenanalysis">R.3. Analysis of population equilibrium (eigenanalysis)<a class="anchor" aria-label="anchor" href="#r-3--analysis-of-population-equilibrium-eigenanalysis"></a>
</h3>
<p>Provided that the transition matrix, <strong>A</strong>, meets
certain conditions, iterative projections from any starting population
vector <span class="math inline">\(\mathbf{n}_{t=0}\)</span> will
eventually converge to an equilibrium per-capita population growth rate
(<span class="math inline">\(\lambda\)</span>) and stable stage
distribution (<span class="math inline">\(\mathbf{w}\)</span>). We can
determine <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\mathbf{w}\)</span> by finding the dominant
eigenvalue and its associated (right) eigenvector, respectively. The
<code>popdemo</code> package provide functions to do these calculations
(the package <code>popbio</code> also provides extensive functionality
for matrix model analysis):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">popdemo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the transition matrix, A</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">3.2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.4</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lambda: equilibrium per-capita population growth rate</span></span>
<span><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">A</span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.51273</span></span>
<span></span>
<span><span class="co"># w: stable stage distribution (relative frequencies)</span></span>
<span><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">A</span>, what <span class="op">=</span> <span class="st">"ss"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4551941 0.3296228 0.2151831</span></span></code></pre></div>
<p>From <span class="math inline">\(\lambda\)</span>, we infer that the
population would eventually grow at an equilibrium rate of 51% per time
step. Likewise, from <span class="math inline">\(\mathbf{w}\)</span> we
infer that nearly half of individuals will be seedlings, about a third
will be rosettes and a fifth will be flowering at equilibrium.</p>
<p>Finally, we are reminded that MPM <em>projections</em> rely on
consistency of the demographic vital rates (i.e., transition matrix
elements) over time. Projections tell us what would happen if this
strong assumption were to be met. Projections differ radically from
<em>forecasts</em>, which are designed to predict what will happen.
Forecasting models may use MPMs to drive population change, but will
also typically require a component that predicts changes in the
underlying demographic vital rates. <a href="#references">Keyfitz
(1972)</a> unpacks these differences further, with special emphasis on
the value of projection as a window into the fundamental processes that
drive the behaviour of populations. Much of the functionality of
<code>Rage</code> rests on this ethos.</p>
</div>
</div>
<div class="section level2">
<h2 id="mpms_in_r">Representing and loading MPMs in <code>Rage</code><a class="anchor" aria-label="anchor" href="#mpms_in_r"></a>
</h2>
<p>We’ll begin by loading one of the example MPMs included in the
<code>Rage</code> package, <code>mpm1</code>, which can be retrieved
using the base ‘data’ function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rage" class="external-link">Rage</a></span><span class="op">)</span> <span class="co"># load Rage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpm1</span><span class="op">)</span> <span class="co"># load data object 'mpm1'</span></span>
<span><span class="va">mpm1</span> <span class="co"># display the contents</span></span>
<span><span class="co">#&gt; $matU</span></span>
<span><span class="co">#&gt;         seed small medium large dormant</span></span>
<span><span class="co">#&gt; seed    0.10  0.00   0.00  0.00    0.00</span></span>
<span><span class="co">#&gt; small   0.05  0.12   0.10  0.00    0.00</span></span>
<span><span class="co">#&gt; medium  0.00  0.35   0.12  0.23    0.12</span></span>
<span><span class="co">#&gt; large   0.00  0.03   0.28  0.52    0.10</span></span>
<span><span class="co">#&gt; dormant 0.00  0.00   0.16  0.11    0.17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matF</span></span>
<span><span class="co">#&gt;         seed small medium large dormant</span></span>
<span><span class="co">#&gt; seed       0     0   17.9  45.6       0</span></span>
<span><span class="co">#&gt; small      0     0    0.0   0.0       0</span></span>
<span><span class="co">#&gt; medium     0     0    0.0   0.0       0</span></span>
<span><span class="co">#&gt; large      0     0    0.0   0.0       0</span></span>
<span><span class="co">#&gt; dormant    0     0    0.0   0.0       0</span></span></code></pre></div>
<p><code>mpm1</code> is a list containing the decomposition of an MPM
projection matrix into its components of growth and survival
(<strong>U</strong>) and reproduction (<strong>R</strong> =
<strong>F</strong> + <strong>C</strong>). Many <code>Rage</code>
functions accept one or more of these components in analyses. The
biological meaning of each list element is indicated by its name:</p>
<ul>
<li>
<code>matU</code> is the <strong>U</strong> matrix, which is the
<strong>growth/survival</strong> component of an MPM, containing
transitions related to progression, stasis and retrogression. This is
how individuals move among ages or life stages.</li>
<li>
<code>matR</code> is the <strong>R</strong> matrix, which is the
<strong>reproductive</strong> component of an MPM, containing
transitions due to reproduction; either sexual, clonal, or both.</li>
<li>
<code>matF</code> is the <strong>F</strong> matrix, which is the
<strong>sexual reproduction</strong> or fecundity component of the MPM,
containing transitions due to sexual reproduction.</li>
<li>
<code>matC</code> is the <strong>C</strong> matrix, which is the
<strong>clonal</strong> component of an MPM, containing transitions due
to clonal reproduction.</li>
</ul>
<p>When the mode of reproduction is known (e.g., a species only
reproduces sexually or the sexual and clonal offspring have been counted
separately), <code>matR</code> can be substituted with <code>matF</code>
or <code>matC</code>.</p>
<p>For any life history, we can reconstruct the full projection matrix,
<strong>A</strong>, by adding together the components. For
<code>mpm1</code>, <strong>A</strong> = <strong>U</strong> +
<strong>F</strong>. A population with separately counted sexual and
clonal offspring production would be <strong>A</strong> =
<strong>U</strong> + <strong>F</strong> + <strong>C</strong>.</p>
<p><code>Rage</code> functions currently accept MPM components as
arguments; therefore, it is not necessary to group the matrix components
together in a list. We anticipate that future package releases will
define methods that accept objects of classes <code>matrix</code>,
<code>CompadreMat</code>, and <code>CompadreDB</code> for compatibility
with the <a href="https://compadre-db.org/" class="external-link">COM(P)ADRE databases</a> and
its accessor package <a href="https://github.com/jonesor/Rcompadre" class="external-link"><code>Rcompadre</code></a>.</p>
</div>
<div class="section level2">
<h2 id="families-of-rage-functions-for-life-history-analysis">Families of <code>Rage</code> functions for life history
analysis<a class="anchor" aria-label="anchor" href="#families-of-rage-functions-for-life-history-analysis"></a>
</h2>
<p>The functions in <code>Rage</code> fall into five broad categories,
and are detailed in the subsections below:</p>
<table class="table">
<colgroup>
<col width="54%">
<col width="45%">
</colgroup>
<thead><tr class="header">
<th>Function category</th>
<th>Stand-alone vignette</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1. <a href="#vitalrates">Vital rates</a>
</td>
<td><a href="https://jonesor.github.io/Rage/articles/a02_VitalRates.html" class="external-link">VitalRates</a></td>
</tr>
<tr class="even">
<td>2. <a href="#lifetable">Life tables</a>
</td>
<td><a href="https://jonesor.github.io/Rage/articles/a03_AgeFromStage.html" class="external-link">AgeFromStage</a></td>
</tr>
<tr class="odd">
<td>3. <a href="#perturb">Perturbation analysis</a>
</td>
<td><a href="https://jonesor.github.io/Rage/articles/a04_TernaryPlots.html" class="external-link">TernaryPlots</a></td>
</tr>
<tr class="even">
<td>4. <a href="#lifehist">Deriving life history traits</a>
</td>
<td><a href="https://jonesor.github.io/Rage/articles/a05_LifeHistoryTraits.html" class="external-link">LifeHistoryTraits</a></td>
</tr>
<tr class="odd">
<td>5. <a href="#maniptransform">Transformation of matrices</a>
</td>
<td>n/a</td>
</tr>
</tbody>
</table>
<p>A full list of functions by category is available at the <a href="https://jonesor.github.io/Rage/reference/index.html" class="external-link">documentation
webpage</a>.</p>
<div class="section level3">
<h3 id="vitalrates">1. Standardized vital rates<a class="anchor" aria-label="anchor" href="#vitalrates"></a>
</h3>
<p>The elements of an MPM transition matrix (<strong>A</strong>)
generally are composites of two or more vital rates (sometimes called
‘lower-level vital rates’). For example, the transition from stage 1 to
stage 2 (element <span class="math inline">\(a_{21}\)</span>) may
colloquially be thought of as ‘growth,’ but importantly this transition
is growth <em>conditional</em> on the individual surviving. Assuming a
post-breeding census design, we can retroactively partition each
transition in MPM submatrices into survival (using the column sums of
<strong>U</strong>) and one of the following: growth (using the lower
triangle of <strong>U</strong>), shrinkage (upper triangle of
<strong>U</strong>), stasis (diagonal of <strong>U</strong>), dormancy
(from <strong>U</strong> with user-indicated dormant stages), fecundity
(from <strong>F</strong>) or clonality (from <strong>C</strong>).</p>
<p>The <code>vr_vec_*</code> family of functions provide a means to
calculate lower-level vital rates for each life stage in the input
matrix or matrices. For example, we can calculate stage-specific
survival and stasis from our example <strong>U</strong> matrix:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vr_vec.html">vr_vec_survival</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span></span>
<span><span class="co">#&gt;    seed   small  medium   large dormant </span></span>
<span><span class="co">#&gt;    0.15    0.50    0.66    0.86    0.39</span></span>
<span><span class="fu"><a href="../reference/vr_vec.html">vr_vec_stasis</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span></span>
<span><span class="co">#&gt;      seed     small    medium     large   dormant </span></span>
<span><span class="co">#&gt; 0.6666667 0.2400000 0.1818182 0.6046512 0.4358974</span></span></code></pre></div>
<p>Multiplying these two together yields the probability of stasis
conditional on survival, in other words the diagonal of our example
<strong>U</strong> matrix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># product of Pr(survival) and Pr(stasis) yields Pr(stasis|survived)</span></span>
<span><span class="fu"><a href="../reference/vr_vec.html">vr_vec_survival</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="../reference/vr_vec.html">vr_vec_stasis</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span></span>
<span><span class="co">#&gt;    seed   small  medium   large dormant </span></span>
<span><span class="co">#&gt;    0.10    0.12    0.12    0.52    0.17</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span> <span class="co"># equivalent to the diagonal of U matrix</span></span>
<span><span class="co">#&gt;    seed   small  medium   large dormant </span></span>
<span><span class="co">#&gt;    0.10    0.12    0.12    0.52    0.17</span></span></code></pre></div>
<p><code>Rage</code> also provides functions to summarize these vital
rates <em>across</em> stage classes using the <code>vr_*</code> family
of functions. These functions return a single value that is the mean of
the corresponding stage-specific vital rate vector from
<code>vr_vec_*</code>. Life stages may be excluded, allowing the user to
tailor these calculations to the life history of the organism and their
working definition of each vital rate. Similarly, custom weights are
allowed to control the contributions of life stages to the average. This
functionality is more fully described in the <a href="https://jonesor.github.io/Rage/articles/a02_VitalRates.html" class="external-link">Vital
Rates vignette</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vr.html">vr_survival</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, exclude_col <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># exclude 'seed' stage</span></span>
<span><span class="co">#&gt; [1] 0.6025</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/vr_vec.html">vr_vec_survival</a></span><span class="op">(</span><span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># equivalent to the mean without 'seed'</span></span>
<span><span class="co">#&gt; [1] 0.6025</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lifetable">2. Deriving life tables from MPMs for age-from-stage analyses<a class="anchor" aria-label="anchor" href="#lifetable"></a>
</h3>
<p>Classical demographic analyses were based on age-structured
populations, in which surviving individuals always progress to the next
age class. However, MPMs allow for demographic rates to be structured by
any number of biological criteria, whether stage, sex, size, or
condition. In these alternatively-structured models, individuals may
remain in the same state or even ‘regress’ to states they had
previously. Here there is no one-to-one mapping between state and age.
Each individual still has an age, and understanding their age-specific
demographic trajectories nevertheless offers a useful window into their
life history. <code>Rage</code> provides functions that decompose MPMs
into life tables, thereby allowing for a wide array of demographic
analyses based on age-specific trajectories (described below in <a href="#lifehist">section 4</a>).</p>
<p>Following the age-from-stage methods of <a href="#references">Caswell
(2001, ch. 5.3)</a>, we can convert an MPM to a full, age-structured
life table or any of its component columns.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mpm_to_table.html">mpm_to_table</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matF <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span><span class="op">)</span> <span class="co"># full life table</span></span>
<span><span class="va">lt</span></span>
<span><span class="co">#&gt;   x         lx         dx        hx        qx        px        ex       mx</span></span>
<span><span class="co">#&gt; 1 0 1.00000000 0.85000000 1.4782609 0.8500000 0.1500000 0.7306918  0.00000</span></span>
<span><span class="co">#&gt; 2 1 0.15000000 0.11000000 1.1578947 0.7333333 0.2666667 1.0379453  0.00000</span></span>
<span><span class="co">#&gt; 3 2 0.04000000 0.02016000 0.6737968 0.5040000 0.4960000 1.5172950  9.54125</span></span>
<span><span class="co">#&gt; 4 3 0.01984000 0.00742535 0.4604204 0.3742616 0.6257384 1.5509980 19.49277</span></span>
<span><span class="co">#&gt; 5 4 0.01241465 0.00397750 0.3815018 0.3203876 0.6796124 1.1796124 24.83256</span></span>
<span><span class="co">#&gt; 6 5 0.00843715 0.00843715 2.0000000 1.0000000 0.0000000 0.5000000 26.79977</span></span>
<span><span class="co">#&gt;        lxmx</span></span>
<span><span class="co">#&gt; 1 0.0000000</span></span>
<span><span class="co">#&gt; 2 0.0000000</span></span>
<span><span class="co">#&gt; 3 0.3816500</span></span>
<span><span class="co">#&gt; 4 0.3867365</span></span>
<span><span class="co">#&gt; 5 0.3082875</span></span>
<span><span class="co">#&gt; 6 0.2261137</span></span>
<span><span class="va">lx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/age_from_stage.html">mpm_to_lx</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span><span class="op">)</span> <span class="co"># survivorship to start of each age class</span></span>
<span><span class="va">lx</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.15000000 0.04000000 0.01984000 0.01241465 0.00843715</span></span></code></pre></div>
<p><code>Rage</code> also supports translation between the different
ways of expressing age-specific mortality/survival, whether proportional
survivorship (<code>lx</code>), survival probability (<code>px</code>)
or mortality hazard (<code>hx</code>), following an <code>x_to_y</code>
function name pattern.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lifetable_convert.html">lx_to_px</a></span><span class="op">(</span>lx <span class="op">=</span> <span class="va">lx</span><span class="op">)</span> <span class="co"># survivorship to survival probability</span></span>
<span><span class="co">#&gt; [1] 0.1500000 0.2666667 0.4960000 0.6257384 0.6796124        NA</span></span>
<span><span class="fu"><a href="../reference/lifetable_convert.html">lx_to_hx</a></span><span class="op">(</span>lx <span class="op">=</span> <span class="va">lx</span><span class="op">)</span> <span class="co"># survivorship to mortality hazard</span></span>
<span><span class="co">#&gt; [1] 1.8971200 1.3217558 0.7011794 0.4688229 0.3862326        NA</span></span></code></pre></div>
<p>When individuals can remain in the last life stage class,
age-specific trajectories of mortality and fertility can appear to
plateau as a cohort asymptotically approaches its stable stage
distribution (SSD). For these MPMs, we can choose a quasi-stationary
distribution (QSD) of stages that is within an arbitrarily close
threshold of the SSD. Subsetting age-specific demographic trajectories
to time points before a cohort reaches the QSD will minimise these
plateau artefacts. In the example MPM, <code>mpm1</code>, a cohort of
germinated individuals quickly converges towards the SSD:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># project a germinated cohort through the U matrix</span></span>
<span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/project.html" class="external-link">project</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">popStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/Projection-class.html" class="external-link">vec</a></span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/Projection-class.html" class="external-link">vec</a></span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">popStructure</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"proportion in stage class"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_GettingStarted_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Using <code>qsd_converge</code>, we can find the time at which the
cohort reaches the QSD and subset the life table or any component
age-specific trajectory accordingly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate time to QSD from the U matrix of an MPM</span></span>
<span><span class="op">(</span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qsd_converge.html">qsd_converge</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, start <span class="op">=</span> <span class="st">"small"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span></span>
<span><span class="co"># subset the life table rows to ages prior to the QSD</span></span>
<span><span class="va">lt_preQSD</span> <span class="op">&lt;-</span> <span class="va">lt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">q</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># plot mortality trajectory from the life table subset (blue),</span></span>
<span><span class="co"># showing plateau effect if the trajectory (grey) was allowed to continue to the</span></span>
<span><span class="co"># QSD (dashed vertical line) and beyond</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/Projection-plots.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">qx</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>  data <span class="op">=</span> <span class="va">lt</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"age"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">qx</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">lt_preQSD</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">q</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_GettingStarted_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We refer readers to the <a href="https://jonesor.github.io/Rage/articles/a03_AgeFromStage.html" class="external-link">AgeFromStage
vignette</a> for further detail on these methods.</p>
</div>
<div class="section level3">
<h3 id="perturb">3. Perturbation analyses<a class="anchor" aria-label="anchor" href="#perturb"></a>
</h3>
<p>Perturbation analyses of MPMs measure the response of demographic
statistics, such as the equilibrium per-capita population growth rate
(<span class="math inline">\(\lambda\)</span>), to perturbations
typically applied at the level of individual matrix elements and which
may be perturbations of a fixed or proportionate amount
(<strong>sensitivities</strong> and <strong>elasticities</strong>,
respectively). By extension, the vital rates (survival, growth, etc.) or
transition type (stasis, retrogression, etc.) underlying multiple matrix
elements may be similarly perturbed. <code>Rage</code> provides
functions for each scope of perturbation, allowing the user to specify
the desired demographic statistic and type of perturbation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct the transition matrix A = U + F (+ C when present)</span></span>
<span><span class="va">mpm1</span><span class="op">$</span><span class="va">matA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mpm1</span>, <span class="va">matU</span> <span class="op">+</span> <span class="va">matF</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sensitivity of lambda to...</span></span>
<span><span class="co"># ...matrix element perturbations</span></span>
<span><span class="fu"><a href="../reference/perturb_matrix.html">perturb_matrix</a></span><span class="op">(</span></span>
<span>  matA <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matA</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"sensitivity"</span>, demog_stat <span class="op">=</span> <span class="st">"lambda"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;               seed      small      medium       large     dormant</span></span>
<span><span class="co">#&gt; seed     0.2173031 0.01133203 0.004786308 0.002986833 0.001150703</span></span>
<span><span class="co">#&gt; small    4.4374613 0.23140857 0.097739870 0.060993320 0.023498191</span></span>
<span><span class="co">#&gt; medium  10.8654599 0.56661979 0.239323184 0.149346516 0.057537001</span></span>
<span><span class="co">#&gt; large   21.3053309 1.11104269 0.469270739 0.292842885 0.112820081</span></span>
<span><span class="co">#&gt; dormant  3.6111989 0.18831947 0.079540419 0.049636195 0.019122779</span></span>
<span><span class="co"># ...vital rate perturbations</span></span>
<span><span class="fu"><a href="../reference/perturb_vr.html">perturb_vr</a></span><span class="op">(</span></span>
<span>  matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matF <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"sensitivity"</span>, demog_stat <span class="op">=</span> <span class="st">"lambda"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $survival</span></span>
<span><span class="co">#&gt; [1] 2.986054</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $growth</span></span>
<span><span class="co">#&gt; [1] 1.077597</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $shrinkage</span></span>
<span><span class="co">#&gt; [1] -0.1653284</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fecundity</span></span>
<span><span class="co">#&gt; [1] 0.00572764</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clonality</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co"># ...transition type perturbations</span></span>
<span><span class="fu"><a href="../reference/perturb_trans.html">perturb_trans</a></span><span class="op">(</span></span>
<span>  matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matF <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"sensitivity"</span>, demog_stat <span class="op">=</span> <span class="st">"lambda"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $stasis</span></span>
<span><span class="co">#&gt; [1] 1.000001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $retro</span></span>
<span><span class="co">#&gt; [1] 0.4174435</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $progr</span></span>
<span><span class="co">#&gt; [1] 6.713571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fecundity</span></span>
<span><span class="co">#&gt; [1] 0.007773141</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clonality</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lifehist">4. Deriving life history traits<a class="anchor" aria-label="anchor" href="#lifehist"></a>
</h3>
<p>What is the life expectancy of an individual? At what age will it
begin to reproduce? How likely is it to survive to reproduction? What is
the generation time? These high-level questions address the
population-level life history traits that emerge from aggregating
individual-level demographic rates, and tracing trajectories through the
life cycle.</p>
<p><code>Rage</code> provides functions to calculate a wide range of
life history traits from both MPMs and life tables. We illustrate the
general pattern of these functions below, referring the reader to the <a href="https://jonesor.github.io/Rage/articles/a05_LifeHistoryTraits.html" class="external-link">LifeHistoryTraits
vignette</a> and the <a href="https://jonesor.github.io/Rage/reference/index.html" class="external-link">documentation
webpage</a> for a complete list of functionality.</p>
<p>MPM-based analyses take the required submatrix (or submatrices),
optionally allowing the user to specify the life stage at which to start
the calculation, choose among alternative methods and set cut-off
thresholds.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># post-germination time steps until post-germination survivorship falls below 5%</span></span>
<span><span class="fu"><a href="../reference/longevity.html">longevity</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, start <span class="op">=</span> <span class="st">"small"</span>, lx_crit <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co"># expected lifetime production of 'small' offspring by a 'small' individual</span></span>
<span><span class="fu"><a href="../reference/net_repro_rate.html">net_repro_rate</a></span><span class="op">(</span></span>
<span>  matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matR <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>, start <span class="op">=</span> <span class="st">"seed"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"start"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.852091</span></span></code></pre></div>
<p>When calculating life table-based traits, MPMs can be transformed to
the necessary age-based trajectory prior to analysis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># derive post-germination survivorship trajectory from U matrix</span></span>
<span><span class="va">lx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/age_from_stage.html">mpm_to_lx</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, start <span class="op">=</span> <span class="st">"small"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/entropy_k.html">entropy_k</a></span><span class="op">(</span>lx <span class="op">=</span> <span class="va">lx</span><span class="op">)</span> <span class="co"># calculate Keyfitz' entropy</span></span>
<span><span class="co">#&gt; [1] 0.9077186</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="maniptransform">5. Transforming MPMs<a class="anchor" aria-label="anchor" href="#maniptransform"></a>
</h3>
<p><code>Rage</code> includes a variety of functions that can be used to
manipulate or transform MPMs. For example, we can collapse an MPM to a
smaller number of stage classes using <code><a href="../reference/mpm_collapse.html">mpm_collapse()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># collapse 'small', 'medium', and 'large' stages into single stage class</span></span>
<span><span class="va">col1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mpm_collapse.html">mpm_collapse</a></span><span class="op">(</span></span>
<span>  matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matF <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span>,</span>
<span>  collapse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">col1</span><span class="op">$</span><span class="va">matA</span></span>
<span><span class="co">#&gt;      [,1]        [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.10 11.61331815 0.00</span></span>
<span><span class="co">#&gt; [2,] 0.05  0.53908409 0.22</span></span>
<span><span class="co">#&gt; [3,] 0.00  0.05728085 0.17</span></span></code></pre></div>
<p>Notice that the stage names are lost during this operation. We can
re-add new stage names using the function <code>name_stages</code>,
electing to use generic or custom names.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># automated stage naming</span></span>
<span><span class="op">(</span><span class="va">col1_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/name_stages.html">name_stages</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">col1</span>, prefix <span class="op">=</span> <span class="st">"class_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $matA</span></span>
<span><span class="co">#&gt;         class_1     class_2 class_3</span></span>
<span><span class="co">#&gt; class_1    0.10 11.61331815    0.00</span></span>
<span><span class="co">#&gt; class_2    0.05  0.53908409    0.22</span></span>
<span><span class="co">#&gt; class_3    0.00  0.05728085    0.17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matU</span></span>
<span><span class="co">#&gt;         class_1    class_2 class_3</span></span>
<span><span class="co">#&gt; class_1    0.10 0.00000000    0.00</span></span>
<span><span class="co">#&gt; class_2    0.05 0.53908409    0.22</span></span>
<span><span class="co">#&gt; class_3    0.00 0.05728085    0.17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matF</span></span>
<span><span class="co">#&gt;         class_1  class_2 class_3</span></span>
<span><span class="co">#&gt; class_1       0 11.61332       0</span></span>
<span><span class="co">#&gt; class_2       0  0.00000       0</span></span>
<span><span class="co">#&gt; class_3       0  0.00000       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matC</span></span>
<span><span class="co">#&gt;         class_1 class_2 class_3</span></span>
<span><span class="co">#&gt; class_1       0       0       0</span></span>
<span><span class="co">#&gt; class_2       0       0       0</span></span>
<span><span class="co">#&gt; class_3       0       0       0</span></span>
<span></span>
<span><span class="co"># overwrite with custom stages</span></span>
<span><span class="op">(</span><span class="va">col1_cust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/name_stages.html">name_stages</a></span><span class="op">(</span></span>
<span>  mat <span class="op">=</span> <span class="va">col1</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seed"</span>, <span class="st">"active"</span>, <span class="st">"dormant"</span><span class="op">)</span>,</span>
<span>  prefix <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $matA</span></span>
<span><span class="co">#&gt;         seed      active dormant</span></span>
<span><span class="co">#&gt; seed    0.10 11.61331815    0.00</span></span>
<span><span class="co">#&gt; active  0.05  0.53908409    0.22</span></span>
<span><span class="co">#&gt; dormant 0.00  0.05728085    0.17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matU</span></span>
<span><span class="co">#&gt;         seed     active dormant</span></span>
<span><span class="co">#&gt; seed    0.10 0.00000000    0.00</span></span>
<span><span class="co">#&gt; active  0.05 0.53908409    0.22</span></span>
<span><span class="co">#&gt; dormant 0.00 0.05728085    0.17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matF</span></span>
<span><span class="co">#&gt;         seed   active dormant</span></span>
<span><span class="co">#&gt; seed       0 11.61332       0</span></span>
<span><span class="co">#&gt; active     0  0.00000       0</span></span>
<span><span class="co">#&gt; dormant    0  0.00000       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matC</span></span>
<span><span class="co">#&gt;         seed active dormant</span></span>
<span><span class="co">#&gt; seed       0      0       0</span></span>
<span><span class="co">#&gt; active     0      0       0</span></span>
<span><span class="co">#&gt; dormant    0      0       0</span></span></code></pre></div>
<p>The transition rates in the collapsed matrix are a weighted average
of the transition rates from the relevant stages of the original matrix,
weighted by the stable distribution at equilibrium. This process
guarantees that the collapsed MPM will retain the same population growth
rate as the original. However, other demographic and life history
characteristics will not necessarily be preserved.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare population growth rate of original and collapsed MPM (preserved)</span></span>
<span><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matA</span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.121037</span></span>
<span><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">col1_cust</span><span class="op">$</span><span class="va">matA</span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.121037</span></span>
<span></span>
<span><span class="co"># compare net reproductive rate of original and collapsed MPM (not preserved)</span></span>
<span><span class="fu"><a href="../reference/net_repro_rate.html">net_repro_rate</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matU</span>, matR <span class="op">=</span> <span class="va">mpm1</span><span class="op">$</span><span class="va">matF</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.852091</span></span>
<span><span class="fu"><a href="../reference/net_repro_rate.html">net_repro_rate</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="va">col1_cust</span><span class="op">$</span><span class="va">matU</span>, matR <span class="op">=</span> <span class="va">col1_cust</span><span class="op">$</span><span class="va">matF</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.447468</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Caswell, H. (2001). Matrix Population Models: Construction, Analysis,
and Interpretation. 2nd edition. Sinauer Associates, Sunderland, MA.
ISBN-10: 0878930965</p>
<p>Keyfitz, N. (1972). On future population. Journal of the American
Statistical Association 67:347-363.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Patrick Barks, Pol Capdevila, Hal Caswell, Judy P. Che-Castaldo, Richard A. Hinrichsen, John Jackson, Tamora James, Owen Jones, Sam Levin, William K. Petry, Roberto Salguero-Gomez, Iain Stott, Chelsea C. Thomas, Christina M. Hernández.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
